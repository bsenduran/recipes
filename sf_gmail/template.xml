<template xmlns="http://ws.apache.org/ns/synapse" name="SampleRecipe">

    <parameter name="salesforce.oauthConsumerKey"/>
    <parameter name="salesforce.oauthConsumerSecret"/>
    <parameter name="salesforce.oauthAccessToken"/>
    <parameter name="salesforce.oauthRefreshToken"/>
    <parameter name="salesforce.instanceUrl"/>
    <parameter name="salesforce.batchsize"/>

    <parameter name="gmail.receiver"/>
    <parameter name="gmail.oauthAccessToken"/>
    <parameter name="gmail.subject"/>
    <parameter name="gmail.content"/>


    <sequence>
       

       <salesforce.oAuth2init>
         	<oauthConsumerKey>{get-property('func','salesforce.oauthConsumerKey')}</oauthConsumerKey>
      		<oauthConsumerSecret>{get-property('func','salesforce.oauthConsumerSecret')}</oauthConsumerSecret>
      		<oauthAccessToken>{get-property('func','salesforce.oauthAccessToken')}</oauthAccessToken>
      		<oauthRefreshToken>{get-property('func','salesforce.oauthRefreshToken')}</oauthRefreshToken>
      		<instanceUrl>{get-property('func','salesforce.instanceUrl')}</instanceUrl>
       </salesforce.oAuth2init>
       

       <log level="custom">
          <property name="logInit" value="Salesforce - OAuth2_init done"/>
       </log>

       <log level="full"/>

      <salesforce.queryAccount>
        <queryString>SELECT Name, Id, AnnualRevenue from Account where CreatedDate > 2014-11-28T01:02:03Z</queryString>
      </salesforce.queryAccount>
              
      <log level="custom">
            <property name="QUERY SF" value="Salesforce - QUERY done"/>
       </log>

      <log level="full"/>


      <property name="NEW_NAME"
                         expression="$body//Name"
                         scope="default"
                         type="STRING"/>

      <property name="NEW_PHONE"
                         expression="$body//Phone"
                         scope="default"
                         type="STRING"/>


      <property name="EMAIL_BODY"
                         expression="fn:concat(get-property('func','gmail.content'),get-property('NEW_NAME'), ' , ', get-property('NEW_PHONE'))"
                         scope="default"
                         type="STRING"/>


       <gmail.init>
      		<username>{get-property('func','gmail.receiver')}</username>
      		<oauthAccessToken>{get-property('func','gmail.oauthAccessToken')}</oauthAccessToken>
	     </gmail.init>


       <gmail.sendMail>
          <subject>{get-property('func','gmail.subject')}</subject>
          <toRecipients>{get-property('func','gmail.username')}</toRecipients>
          <textContent>{get-property('EMAIL_BODY')}</textContent>
       </gmail.sendMail>
            
       
    </sequence>
</template>


